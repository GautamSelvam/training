<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transactions</title>
</head>
<body>
    <div class="container">
        <h1 > Welcome, <span id="name"></span> !</h1>
        <label for="account">Account Balance:</label>
        <span id="accountBalance">0</span><br><br>
        
        <label for="amount">Transaction Amount:</label>
        <input type="number" id="amount"><br><br><br>
        
        <button id="creditBtn">Credit</button>   
        <button id="debitBtn">Debit</button><br><br>

        <table id="transactionTable">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Transaction Type</th>
                    <th>Amount</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>

       
        <a href="#" id="logoutLink"><p>LogOut</p></a>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var UserDetails = localStorage.getItem('userLoginDetails');
            var user = JSON.parse(UserDetails);
            var name = user.userName;
            document.getElementById('name').textContent =  name;

            var accnum = user.accNum;
            console.log(accnum);
            var acctBalance = user.balance;
            console.log(acctBalance);
            var transactionTable = document.querySelector('#transactionTable tbody');
            var accountBalanceElement = document.getElementById('accountBalance');
            var creditButton = document.getElementById('creditBtn');
            var debitButton = document.getElementById('debitBtn');
            var amountInput = document.getElementById('amount');

            accountBalanceElement.textContent = acctBalance;

            if (localStorage.getItem('transactions')) {
                var transactions = JSON.parse(localStorage.getItem('transactions'));

                var accountTransactions = transactions.filter(function(transaction) {
                    return transaction.accountNumber === accnum;
                });

                accountTransactions.forEach(function(transaction) {
                    appendTransaction(transaction.date, transaction.type, transaction.amount);
                });
            }

            creditButton.addEventListener('click', function() {
                var amount = parseFloat(amountInput.value);
                if(amount < 0){
                    alert('Negative number not allowed');
                } else {
                    acctBalance += amount;
                    updateAccountBalance(accnum,acctBalance);
                    saveTransaction('Credit', amount);
                }
            });

            debitButton.addEventListener('click', function() {
                var amount = parseFloat(amountInput.value);
                if (amount < 0) {
                    alert('Negative number not allowed');
                } else if (acctBalance - amount < 0) {
                    alert('Not enough money in your account');
                } else {
                    acctBalance -= amount;
                    updateAccountBalance(accnum,acctBalance);
                    saveTransaction('Debit', amount);
                }
            });

            function updateAccountBalance(accnum,balance) {
                // localStorage.setItem('accountBalance', balance);
                // localStorage.setItem(accNum1, balance);
                accountBalanceElement.textContent = balance;

                var existingData = localStorage.getItem('userData');
                if (existingData) {
                    var userData = JSON.parse(existingData);
                    for (var i = 0; i < userData.length; i++) {
                        if (userData[i].accNum == accnum) {
                            userData[i].balance = balance;
                            break;
                        }
                    }
                    localStorage.setItem('userData', JSON.stringify(userData));
                }
            }
            

            function saveTransaction(type, amount) {
                var transactions = [];

                if (localStorage.getItem('transactions')) {
                    transactions = JSON.parse(localStorage.getItem('transactions'));
                }

                var transaction = {
                    accountNumber: accnum,
                    date: new Date().toLocaleString(),
                    type: type,
                    amount: amount
                };

                transactions.push(transaction);
                localStorage.setItem('transactions', JSON.stringify(transactions));
                appendTransaction(transaction.date, transaction.type, transaction.amount);
            }

            function appendTransaction(date, type, amount) {
                var row = document.createElement('tr');
                var dateCell = document.createElement('td');
                var typeCell = document.createElement('td');
                var amountCell = document.createElement('td');

                dateCell.textContent = date;
                typeCell.textContent = type;
                amountCell.textContent = amount;

                row.appendChild(dateCell);
                row.appendChild(typeCell);
                row.appendChild(amountCell);

                transactionTable.appendChild(row);
            }

            var logoutLink = document.getElementById('logoutLink');

            logoutLink.addEventListener('click', function() {
                localStorage.removeItem('userLoginDetails');
            

                window.location.href = 'login.html';
            });
        });
    </script>
</body>
</html>
